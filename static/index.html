<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SAT Practice</title>

<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">

<!-- MathJax -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$']],
      displayMath: [['$$', '$$']]
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
body {
  margin: 0;
  font-family: 'Merriweather', serif;
  background: #fafafa;
}
header {
  text-align: center;
  padding: 60px 20px;
  background: white;
  border-bottom: 1px solid #eee;
}
.container {
  max-width: 850px;
  margin: 40px auto;
}
.card {
  background: white;
  padding: 40px;
  border-radius: 8px;
  border: 1px solid #ddd;
}
select, button {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
}
button {
  background: #2a2a2a;
  color: white;
  border: none;
  cursor: pointer;
}
button:disabled {
  background: #ccc;
}
.question-text {
  white-space: pre-wrap;
  line-height: 1.7;
}
.choice {
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 14px;
  margin: 12px 0;
  cursor: pointer;
}
.choice:hover {
  background: #f0f0f0;
}
.choice.correct {
  background: #e8f5e9;
  border-color: #2e7d32;
}
.choice.incorrect {
  background: #fdecea;
  border-color: #c62828;
}
</style>
</head>

<body>

<header>
  <h1>SAT Practice</h1>
</header>

<div class="container">
  <div class="card">
    <select id="section">
      <option value="">Select Section</option>
      <option value="Reading and Writing">Reading and Writing</option>
      <option value="Math">Math</option>
    </select>

    <select id="topic">
      <option value="">Select Topic</option>
      <option>Algebra</option>
      <option>Advanced Math</option>
      <option>Problem-Solving and Data Analysis</option>
      <option>Geometry and Trigonometry</option>
    </select>

    <select id="difficulty">
      <option>Easy</option>
      <option selected>Medium</option>
      <option>Hard</option>
    </select>

    <button id="generate">Generate Question</button>

    <div id="output" style="margin-top:30px;"></div>
  </div>
</div>

<script>
const API_ORIGIN = location.origin;
const output = document.getElementById("output");

document.getElementById("generate").onclick = async () => {
  output.innerHTML = "Generating...";

  const resp = await fetch(`${API_ORIGIN}/api/generate-question`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      section: section.value,
      topic: topic.value,
      difficulty: difficulty.value
    })
  });

  const { text } = await resp.json();

  const q = text.match(/Question:\s*([\s\S]*?)Answer Choices:/)[1].trim();
  const a = text.match(/Answer Choices:\s*([\s\S]*?)Correct Answer:/)[1].trim();
  const c = text.match(/Correct Answer:\s*([A-D])/)[1];
  const e = text.match(/Explanation:\s*([\s\S]*)$/)[1].trim();

  const choices = a.split(/\n(?=[A-D]\.)/).map(s => ({
    letter: s[0],
    text: s.slice(2).trim()
  }));

  output.innerHTML = `
    <div class="question-text">${q}</div>
    ${choices.map(x => `
      <div class="choice" data-l="${x.letter}">
        <strong>${x.letter}.</strong> ${x.text}
      </div>
    `).join("")}
    <div id="explanation" style="display:none;margin-top:20px;">
      <hr>
      <strong>Correct Answer:</strong> ${c}<br><br>
      ${e}
    </div>
  `;

  document.querySelectorAll(".choice").forEach(el => {
    el.onclick = () => {
      document.querySelectorAll(".choice").forEach(c2 => {
        c2.style.pointerEvents = "none";
        c2.classList.add(
          c2.dataset.l === c ? "correct" : "incorrect"
        );
      });
      document.getElementById("explanation").style.display = "block";
      MathJax.typesetPromise();
    };
  });

  MathJax.typesetPromise();
};
</script>

</body>
</html>
