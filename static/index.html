<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MathJax Self-Test</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f6f6f6;
  padding: 40px;
}
.card {
  background: white;
  max-width: 800px;
  margin: auto;
  padding: 30px;
  border-radius: 8px;
  border: 1px solid #ddd;
}
pre {
  background: #eee;
  padding: 12px;
  white-space: pre-wrap;
}
button {
  padding: 10px 14px;
  margin-top: 12px;
}
</style>

<!-- ✅ MathJax config FIRST -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$']],
      displayMath: [['$$', '$$']]
    },
    startup: {
      typeset: false
    }
  };
</script>

<!-- ✅ MathJax loader -->
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>

<body>

<div class="card" id="box">
  <h2>MathJax Self-Test</h2>

  <p>This text should render math:</p>

  <p>
    Inline: $x^2 + 1$<br><br>
    Display:
    $$\frac{3x^2 - 2x + 1}{x - 4}$$
  </p>

  <button id="run">Run MathJax</button>

  <h3>Status</h3>
  <pre id="status"></pre>
</div>

<script>
const status = document.getElementById("status");
const box = document.getElementById("box");

function log(msg) {
  status.textContent += msg + "\n";
}

document.getElementById("run").onclick = async () => {
  status.textContent = "";

  log("window.MathJax: " + (window.MathJax ? "PRESENT" : "MISSING"));

  if (!window.MathJax) return;

  log("MathJax.version: " + (MathJax.version || "unknown"));

  try {
    if (MathJax.startup?.promise) {
      log("Waiting for startup...");
      await MathJax.startup.promise;
      log("Startup ready.");
    }

    log("Calling typesetPromise...");
    MathJax.typesetClear([box]);
    await MathJax.typesetPromise([box]);
    log("SUCCESS ✅ Math rendered");
  } catch (e) {
    log("FAILED ❌");
    log(String(e));
  }
};
</script>

</body>
</html>
